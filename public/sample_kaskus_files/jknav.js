/**
 * @preserve jknav
 * @name      jquery.jknav.js
 * @author    Yu-Jie Lin http://j.mp/Google-livibetter
 * @version   0.5.0.1
 * @date      05-24-2011
 * @copyright (c) 2010, 2011 Yu-Jie Lin <livibetter@gmail.com>
 * @license   BSD License
 * @homepage  http://code.google.com/p/lilbtn/wiki/JsJqueryJknav
 * @example   http://lilbtn.googlecode.com/hg/src/static/js/jquery/jquery.jknav.demo.html
*/
(function(a){function e(e,f){if(e.target.tagName.toLowerCase()=="input"||e.target.tagName.toLowerCase()=="button"||e.target.tagName.toLowerCase()=="select"||e.target.tagName.toLowerCase()=="textarea"){b("keyup: "+e.target.tagName+", target is INPUT ignored.");return}var g=String.fromCharCode(e.keyCode).toLowerCase();b("keyup: "+e.target.tagName+", key: "+g);if(g==f.up.toLowerCase()||g==f.down.toLowerCase()){if(f.reevaluate)a.jknav.index[f.name]=null;var h=d(g==f.down.toLowerCase()?1:-1,f);var i=a(a.jknav.items[f.name][h][0]);a(a.jknav.TARGET).animate({scrollLeft:Math.floor(i.offset().left),scrollTop:Math.floor(i.offset().top)},f.speed,f.easing,function(){c(h,f)})}}function d(c,d){var e=a.jknav.index[d.name];b("Calculating index for "+d.name+", current index = "+e);if(e==null){var f=a(a.jknav.TARGET).scrollTop();b(a.jknav.TARGET+" top = "+f);a.each(a.jknav.items[d.name],function(b,c){var d=Math.floor(a(c).offset().top);if(f>=d)e=b});if(e==null){if(c>0)e=0;else e=a.jknav.items[d.name].length-1}else{if(c>0&&++e>=a.jknav.items[d.name].length)e=0;else if(c<0&&f==Math.floor(a(a.jknav.items[d.name][e]).offset().top)&&--e<0)e=a.jknav.items[d.name].length-1}}else{if(!d.circular&&(e==0&&c==-1||e==a.jknav.items[d.name].length-1&&c==1))return e;e+=c;if(e>=a.jknav.items[d.name].length)e=0;if(e<0)e=a.jknav.items[d.name].length-1}b("new index = "+e);a.jknav.index[d.name]=e;return e}function c(b,c){var d=a.jknav.items[c.name][b][1];if(d)d(a.jknav.items[c.name][b][0])}function b(b){var c=window.console;if(a.jknav.DEBUG&&c&&c.log)c.log("jknav: "+b)}a.fn.jknav=function(b,c){if(c==null)c="default";if(a.jknav.items[c]==null)a.jknav.items[c]=[];return this.each(function(){a.jknav.items[c].push([this,b]);a.jknav.items[c].sort(function(b,c){var d=a(b[0]).offset().top;var e=a(c[0]).offset().top;if(d<e)return-1;if(d>e)return 1;if(d==e){var f=a(b[0]).offset().left;var g=a(c[0]).offset().left;if(f<g)return-1;if(f>g)return 1;return 0}})})};a.jknav={index:{},items:{},opts:{},default_options:{up:"k",down:"j",name:"default",easing:"swing",speed:"normal",circular:true,reevaluate:false},DEBUG:false,TARGET_KEYUP:"html",TARGET:!a.browser.webkit?"html":"body",init:function(c){var d=a.extend(a.extend({},a.jknav.default_options),c);a.jknav.index[d.name]=null;a.jknav.opts[d.name]=d;a(a.jknav.TARGET_KEYUP).keyup(function(a){e(a,d)});b('new set "'+d.name+'" initialzed.')},up:function(b){var c=a.jknav.opts[b||"default"];e({target:{tagName:""},keyCode:c.up.charCodeAt(0)},c)},down:function(b){var c=a.jknav.opts[b||"default"];e({target:{tagName:""},keyCode:c.down.charCodeAt(0)},c)}}})(jQuery)
