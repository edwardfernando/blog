(function(R){var O,G,I,J,Z,K,S,L,Q,D,Y={boxId:"superbox",boxClasses:"",overlayOpacity:0.8,boxWidth:"600",boxHeight:"400",loadTxt:"Loading...",closeTxt:"Close",prevTxt:"Previous",nextTxt:"Next",beforeShow:function(){}},C={},N=false,H=R([]);R.superbox=function(){D=R.extend({},Y,R.superbox.settings);if(R.browser.msie&&R.browser.version<7){H=H.add("select")}M();A()};function A(){R("a[rel^=superbox],area[rel^=superbox]").each(function(){var d=R(this),b=d.attr("rel"),f=b.match(/^superbox\[([^#\.\]]+)/)[1],c=b.replace("superbox","").match(/([#\.][^#\.\]]+)/g)||[],e=D.boxId,a=D.boxClasses;this._relSettings=b.replace("superbox["+f+c.join("")+"]","");R.each(c,function(h,g){if(g.substr(0,1)=="#"){e=g.substr(1)}else{if(g.substr(0,1)=="."){a+=" "+g.substr(1)}}});if(f.search(/^image|gallery|iframe|content|ajax$/)!=-1){d.superbox(f,{boxId:e,boxClasses:a})}})}R.fn.superbox=function(b,a){a=R.extend({},D,a);R.superbox[b](this,a)};R.extend(R.superbox,{image:function(d,a,e){var b=U(d.get(0)),c=false;if(b&&e=="gallery"){c=b[1]}else{if(b){c=b[0]}}d.click(function(f){f.preventDefault();P();if(e=="gallery"){X(d,b[0])}B(function(){var g=false,h;if(c){g=c.split("x")}h=R('<img src="'+d.attr("href")+'" title="'+(d.attr("title")||d.text())+'" />');h.load(function(){T(h,g);V({boxClasses:"image "+a.boxClasses,boxId:a.boxId});F()}).appendTo($innerbox)})})},gallery:function(c,a){var b=U(c.get(0));if(!C[b[0]]){C[b[0]]=[]}C[b[0]].push(c);c.get(0)._superboxGroupKey=(C[b[0]].length-1);R.superbox.image(c,a,"gallery")},iframe:function(c,a){var b=U(c.get(0));c.click(function(d){d.preventDefault();P();B(function(){var e=false,f;if(b){e=b[0].split("x")}a=R.extend({},a,{boxWidth:e[0]||a.boxWidth,boxHeight:e[1]||a.boxHeight});f=R('<iframe src="'+c.attr("href")+'" name="'+c.attr("href")+'" frameborder="0" scrolling="auto" hspace="0" width="'+a.boxWidth+'" height="'+a.boxHeight+'"></iframe>');f.load(function(){J.width(a.boxWidth+"px");$innerbox.height(a.boxHeight+"px");V({boxClasses:"iframe "+a.boxClasses,boxId:a.boxId});F()}).appendTo($innerbox)})})},content:function(c,a){var b=U(c.get(0));c.click(function(d){d.preventDefault();P();B(function(){var e=false;if(b){e=b[0].split("x")}a=R.extend({},a,{boxWidth:e[0]||a.boxWidth,boxHeight:e[1]||a.boxHeight});J.width(a.boxWidth+"px");$innerbox.height(a.boxHeight+"px");R(c.attr("href")).clone().appendTo($innerbox).show();V({boxClasses:"content "+a.boxClasses,boxId:a.boxId});F()})})},ajax:function(c,a){var b=U(c.get(0));c.click(function(d){d.preventDefault();P();B(function(){var e=false;if(b&&b[3]){e=b[3].split("x")}a=R.extend({},a,{boxWidth:e[0]||a.boxWidth,boxHeight:e[1]||a.boxHeight});J.width(a.boxWidth+"px");$innerbox.height(a.boxHeight+"px");R.get(b[2],function(f){R(f).appendTo($innerbox)});V({boxClasses:"ajax "+a.boxClasses,boxId:a.boxId});F()})})}});function U(a){return a._relSettings.match(/([^\[\]]+)/g)}function T(a,b){J.width(a.width()+($innerbox.css("paddingLeft").slice(0,-2)-0)+($innerbox.css("paddingRight").slice(0,-2)-0));$innerbox.height(a.height());if(b&&b[0]!=""){J.width(b[0]+"px")}if(b&&b[1]!=""&&b[1]>a.height()){$innerbox.height(b[1]+"px")}}function X(c,b){S.show();N=true;var a=c.get(0)._superboxGroupKey+1,d=a-2;if(C[b][a]){L.removeClass("disabled").unbind("click").bind("click",function(){C[b][a].click()})}else{L.addClass("disabled").unbind("click")}if(C[b][d]){Q.removeClass("disabled").unbind("click").bind("click",function(){C[b][d].click()})}else{Q.addClass("disabled").unbind("click")}}function V(a){J.attr("id",a.boxId).attr("class",a.boxClasses)}function W(){R(document).unbind("keydown");K.hide();S.hide();G.hide().css({position:"fixed",top:0});$innerbox.empty()}function E(a){W();O.fadeOut(300,function(){H.show()});N=false}function B(b){var a=function(){if(R.browser.msie&&R.browser.version<7){G.css({position:"absolute",top:"50%"})}H.hide();K.show();b()};if(N){O.css("opacity",D.overlayOpacity).show();a()}else{O.css("opacity",0).show().fadeTo(300,D.overlayOpacity,a)}}function P(){G.show();$innerbox.empty();J.css({position:"absolute",top:"-99999px"})}function F(a,b){K.hide();R(document).unbind("keydown").bind("keydown",function(c){if(c.keyCode==27){E()}if(c.keyCode==39&&L.is(":visible")){L.click()}if(c.keyCode==37&&Q.is(":visible")){Q.click()}});J.css({position:"static",top:0,opacity:0});if(R.browser.msie&&R.browser.version<8){J.css({position:"relative",top:"-50%"});if(R.browser.msie&&R.browser.version<7){G.css({position:"absolute",top:"50%"})}}if(R(window).height()<G.height()){G.css({position:"absolute",top:(G.offset().top+10)+"px"})}D.beforeShow();J.fadeTo(300,1)}function M(){if(!R.superbox.elementsReady){O=R('<div id="superbox-overlay"></div>').appendTo("body").hide();G=R('<div id="superbox-wrapper"></div>').appendTo("body").hide();I=R('<div id="superbox-container"></div>').appendTo(G);J=R('<div id="superbox"></div>').appendTo(I);$innerbox=R('<div id="superbox-innerbox"></div>').appendTo(J);S=R('<p class="nextprev"></p>').appendTo(J).hide();Q=R('<a class="prev"><strong><span>'+D.prevTxt+"</span></strong></a>").appendTo(S);L=R('<a class="next"><strong><span>'+D.nextTxt+"</span></strong></a>").appendTo(S);Z=R('<p class="close"><a><strong><span>'+D.closeTxt+"</span></strong></a></p>").prependTo(J).find("a");K=R('<p class="loading">'+D.loadTxt+"</p>").appendTo(I).hide();O.add(G).add(Z).click(function(){E()});J.click(function(a){a.stopPropagation()});R.superbox.elementsReady=true}}})(jQuery);